/*
 * Copyright (c) 2025 Le Juez Victor
 *
 * This software is provided "as-is", without any express or implied warranty. In no event
 * will the authors be held liable for any damages arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose, including commercial
 * applications, and to alter it and redistribute it freely, subject to the following restrictions:
 *
 *   1. The origin of this software must not be misrepresented; you must not claim that you
 *   wrote the original software. If you use this software in a product, an acknowledgment
 *   in the product documentation would be appreciated but is not required.
 *
 *   2. Altered source versions must be plainly marked as such, and must not be misrepresented
 *   as being the original software.
 *
 *   3. This notice may not be removed or altered from any source distribution.
 */

// NOTE: This file is automatically generated during the CMake configuration process

#include "./r3d_shaders.h"

const char VS_COMMON_SCREEN[] = "#version 330 core\nlayout(location=0)in vec3 aPosition;layout(location=1)in vec2 aTexCoord;noperspective out vec2 vTexCoord;void main(){gl_Position=vec4(aPosition,1.0);vTexCoord=aTexCoord;}";
const char VS_COMMON_CUBEMAP[] = "#version 330 core\nlayout(location=0)in vec3 aPosition;uniform mat4 uMatProj;uniform mat4 uMatView;out vec3 vPosition;void main(){vPosition=aPosition;gl_Position=uMatProj*uMatView*vec4(vPosition,1.0);}";

const char FS_GENERATE_GAUSSIAN_BLUR_DUAL_PASS[] = "#version 330 core\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexture;uniform vec2 uTexelDir;out vec4 a;const int SAMPLE_COUNT=6;const float OFFSETS[6]=float[6](-4.455269417428358,-2.4751038298192056,-0.4950160492928827,1.485055021558738,3.465172537482815,5);const float WEIGHTS[6]=float[6](0.14587920530480702,0.19230308352110734,0.21647621943673803,0.20809835496561988,0.17082879595769634,0.06641434081403137);void main(){vec3 c=vec3(0.0);for(int b=0;b < SAMPLE_COUNT;++b){c+=texture(uTexture,vTexCoord+uTexelDir*OFFSETS[b]).rgb*WEIGHTS[b];}a=vec4(c,1.0);}";
const char FS_GENERATE_CUBEMAP_FROM_EQUIRECTANGULAR[] = "#version 330 core\nin vec3 vPosition;uniform sampler2D uTexEquirectangular;out vec4 a;vec2 SampleSphericalMap(vec3 d){vec2 c=vec2(atan(d.z,d.x),asin(d.y));c*=vec2(0.1591,-0.3183);c+=0.5;return c;}void main(){vec2 c=SampleSphericalMap(normalize(vPosition));vec3 b=texture(uTexEquirectangular,c).rgb;a=vec4(b,1.0);}";
const char FS_GENERATE_IRRADIANCE_CONVOLUTION[] = "#version 330 core\n#define PI 3.14159265359\nin vec3 vPosition;uniform samplerCube uTexCubemap;out vec4 a;void main(){vec3 N=normalize(vPosition);vec3 b=vec3(0.0);vec3 j=vec3(0.0,1.0,0.0);vec3 e=normalize(cross(j,N));j=normalize(cross(N,e));float f=0.025;float c=0.0;for(float d=0.0;d < 2.0*PI;d+=f){for(float i=0.0;i < 0.5*PI;i+=f){vec3 h=vec3(sin(i)*cos(d),sin(i)*sin(d),cos(i));vec3 g=h.x*e+h.y*j+h.z*N;b+=texture(uTexCubemap,g).rgb*cos(i)*sin(i);c++;}}b=PI*b*(1.0/float(c));a=vec4(b,1.0);}";
const char FS_GENERATE_PREFILTER[] = "#version 330 core\n#define PI 3.14159265359\nin vec3 vPosition;uniform samplerCube uTexCubemap;uniform float uRoughness;out vec4 a;float DistributionGGX(vec3 N,vec3 H,float t){float g=t*t;float h=g*g;float c=max(dot(N,H),0.0);float d=c*c;float o=h;float l=(d*(h-1.0)+1.0);l=PI*l*l;return o/l;}float RadicalInverse_VdC(uint j){j=(j << 16u)|(j >> 16u);j=((j & 0x55555555u)<< 1u)|((j & 0xAAAAAAAAu)>> 1u);j=((j & 0x33333333u)<< 2u)|((j & 0xCCCCCCCCu)>> 2u);j=((j & 0x0F0F0F0Fu)<< 4u)|((j & 0xF0F0F0F0u)>> 4u);j=((j & 0x00FF00FFu)<< 8u)|((j & 0xFF00FF00u)>> 8u);return float(j)*2.3283064365386963e-10;}vec2 Hammersley(uint m,uint N){return vec2(float(m)/float(N),RadicalInverse_VdC(m));}vec3 ImportanceSampleGGX(vec2 f,vec3 N,float t){float g=t*t;float q=2.0*PI*f.x;float k=sqrt((1.0-f.y)/(1.0+(g*g-1.0)*f.y));float x=sqrt(1.0-k*k);vec3 H;H.x=cos(q)*x;H.y=sin(q)*x;H.z=k;vec3 aa=abs(N.z)< 0.999 ? vec3(0.0,0.0,1.0): vec3(1.0,0.0,0.0);vec3 y=normalize(cross(aa,N));vec3 i=cross(N,y);vec3 w=y*H.x+i*H.y+N*H.z;return normalize(w);}void main(){vec3 N=normalize(vPosition);vec3 R=N;vec3 V=R;const uint SAMPLE_COUNT=1024u;vec3 r=vec3(0.0);float z=0.0;for(uint m=0u;m < SAMPLE_COUNT;++m){vec2 f=Hammersley(m,SAMPLE_COUNT);vec3 H=ImportanceSampleGGX(f,N,uRoughness);vec3 L=normalize(2.0*dot(V,H)*H-V);float e=max(dot(N,L),0.0);if(e > 0.0){float D=DistributionGGX(N,H,uRoughness);float c=max(dot(N,H),0.0);float b=max(dot(H,V),0.0);float p=D*c/(4.0*b)+0.0001;float s=512.0;float v=4.0*PI/(6.0*s*s);float u=1.0/(float(SAMPLE_COUNT)*p+0.0001);float n=(uRoughness==0.0)? 0.0 : 0.5*log2(u/v);r+=textureLod(uTexCubemap,L,n).rgb*e;z+=e;}}r=r/z;a=vec4(r,1.0);}";

const char VS_RASTER_GEOMETRY[] = "#version 330 core\nlayout(location=0)in vec3 aPosition;layout(location=1)in vec2 aTexCoord;layout(location=2)in vec3 aNormal;layout(location=3)in vec4 aColor;layout(location=4)in vec4 aTangent;uniform mat4 uMatNormal;uniform mat4 uMatModel;uniform mat4 uMatMVP;uniform float uValEmission;uniform vec3 uColEmission;uniform vec3 uColAlbedo;uniform vec2 uTexCoordOffset;uniform vec2 uTexCoordScale;flat out vec3 vEmission;out vec2 vTexCoord;out vec3 vColor;out mat3 vTBN;void main(){vTexCoord=uTexCoordOffset+aTexCoord*uTexCoordScale;vColor=aColor.rgb*uColAlbedo;vEmission=uColEmission*uValEmission;vec3 T=normalize(vec3(uMatModel*vec4(aTangent.xyz,0.0)));vec3 N=normalize(vec3(uMatNormal*vec4(aNormal,0.0)));vec3 B=normalize(cross(N,T))*aTangent.w;vTBN=mat3(T,B,N);gl_Position=uMatMVP*vec4(aPosition,1.0);}";
const char VS_RASTER_GEOMETRY_INST[] = "#version 330 core\n#define BILLBOARD_FRONT 1\n#define BILLBOARD_Y_AXIS 2\nlayout(location=0)in vec3 aPosition;layout(location=1)in vec2 aTexCoord;layout(location=2)in vec3 aNormal;layout(location=3)in vec4 aColor;layout(location=4)in vec4 aTangent;layout(location=10)in mat4 iMatModel;layout(location=14)in vec4 iColor;uniform mat4 uMatInvView;uniform mat4 uMatModel;uniform mat4 uMatVP;uniform lowp int uBillboardMode;uniform float uValEmission;uniform vec3 uColEmission;uniform vec3 uColAlbedo;uniform vec2 uTexCoordOffset;uniform vec2 uTexCoordScale;flat out vec3 vEmission;out vec2 vTexCoord;out vec3 vColor;out mat3 vTBN;void BillboardFront(inout mat4 h,inout mat3 i){float l=length(vec3(h[0]));float m=length(vec3(h[1]));float n=length(vec3(h[2]));h[0]=vec4(normalize(uMatInvView[0].xyz)*l,0.0);h[1]=vec4(normalize(uMatInvView[1].xyz)*m,0.0);h[2]=vec4(normalize(uMatInvView[2].xyz)*n,0.0);float b=1.0/l;float c=1.0/m;float d=1.0/n;i[0]=normalize(uMatInvView[0].xyz)*b;i[1]=normalize(uMatInvView[1].xyz)*c;i[2]=normalize(uMatInvView[2].xyz)*d;}void BillboardY(inout mat4 h,inout mat3 i){vec3 j=vec3(h[3]);float l=length(vec3(h[0]));float m=length(vec3(h[1]));float n=length(vec3(h[2]));vec3 o=normalize(vec3(h[1]));vec3 e=normalize(j-vec3(uMatInvView[3]));vec3 k=normalize(cross(o,e));vec3 a=normalize(cross(k,o));h[0]=vec4(k*l,0.0);h[1]=vec4(o*m,0.0);h[2]=vec4(a*n,0.0);float b=1.0/l;float c=1.0/m;float d=1.0/n;i[0]=k*b;i[1]=o*c;i[2]=a*d;}void main(){vTexCoord=uTexCoordOffset+aTexCoord*uTexCoordScale;vEmission=uColEmission*uValEmission;vColor=aColor.rgb*iColor.rgb*uColAlbedo;mat4 f=uMatModel*transpose(iMatModel);mat3 g=mat3(0.0);if(uBillboardMode==BILLBOARD_FRONT)BillboardFront(f,g);else if(uBillboardMode==BILLBOARD_Y_AXIS)BillboardY(f,g);else g=transpose(inverse(mat3(f)));vec3 T=normalize(vec3(f*vec4(aTangent.xyz,0.0)));vec3 N=normalize(g*aNormal);vec3 B=normalize(cross(N,T))*aTangent.w;vTBN=mat3(T,B,N);gl_Position=uMatVP*(f*vec4(aPosition,1.0));}";
const char FS_RASTER_GEOMETRY[] = "#version 330 core\nflat in vec3 vEmission;in vec2 vTexCoord;in vec3 vColor;in mat3 vTBN;uniform sampler2D uTexAlbedo;uniform sampler2D uTexNormal;uniform sampler2D uTexEmission;uniform sampler2D uTexOcclusion;uniform sampler2D uTexRoughness;uniform sampler2D uTexMetalness;uniform float uValOcclusion;uniform float uValRoughness;uniform float uValMetalness;layout(location=0)out vec3 a;layout(location=1)out vec3 b;layout(location=2)out vec2 c;layout(location=3)out vec3 d;vec2 EncodeOctahedral(vec3 f){f/=abs(f.x)+abs(f.y)+abs(f.z);vec2 e=f.xy;if(f.z < 0.0){vec2 g=vec2(f.x >=0.0 ? 1.0 :-1.0,f.y >=0.0 ? 1.0 :-1.0);e=(1.0-abs(e.yx))*g;}return e*0.5+0.5;}void main(){a=vColor*texture(uTexAlbedo,vTexCoord).rgb;b=vEmission*texture(uTexEmission,vTexCoord).rgb;c=EncodeOctahedral(normalize(vTBN*(texture(uTexNormal,vTexCoord).rgb*2.0-1.0)));d.r=uValOcclusion*texture(uTexOcclusion,vTexCoord).r;d.g=uValRoughness*texture(uTexRoughness,vTexCoord).g;d.b=uValMetalness*texture(uTexMetalness,vTexCoord).b;}";
const char VS_RASTER_FORWARD[] = "#version 330 core\n#define NUM_LIGHTS 8\nlayout(location=0)in vec3 aPosition;layout(location=1)in vec2 aTexCoord;layout(location=2)in vec3 aNormal;layout(location=3)in vec4 aColor;layout(location=4)in vec4 aTangent;uniform mat4 uMatNormal;uniform mat4 uMatModel;uniform mat4 uMatMVP;uniform mat4 uMatLightVP[NUM_LIGHTS];uniform vec4 uColAlbedo;uniform vec2 uTexCoordOffset;uniform vec2 uTexCoordScale;out vec3 vPosition;out vec2 vTexCoord;out vec4 vColor;out mat3 vTBN;out vec4 vPosLightSpace[NUM_LIGHTS];void main(){vPosition=vec3(uMatModel*vec4(aPosition,1.0));vTexCoord=uTexCoordOffset+aTexCoord*uTexCoordScale;vColor=aColor*uColAlbedo;vec3 T=normalize(vec3(uMatModel*vec4(aTangent.xyz,0.0)));vec3 N=normalize(vec3(uMatNormal*vec4(aNormal,1.0)));vec3 B=normalize(cross(N,T))*aTangent.w;vTBN=mat3(T,B,N);for(int a=0;a < NUM_LIGHTS;a++){vPosLightSpace[a]=uMatLightVP[a]*vec4(vPosition,1.0);}gl_Position=uMatMVP*vec4(aPosition,1.0);}";
const char VS_RASTER_FORWARD_INST[] = "#version 330 core\n#define NUM_LIGHTS 8\n#define BILLBOARD_FRONT 1\n#define BILLBOARD_Y_AXIS 2\nlayout(location=0)in vec3 aPosition;layout(location=1)in vec2 aTexCoord;layout(location=2)in vec3 aNormal;layout(location=3)in vec4 aColor;layout(location=4)in vec4 aTangent;layout(location=10)in mat4 iMatModel;layout(location=14)in vec4 iColor;uniform mat4 uMatLightVP[NUM_LIGHTS];uniform mat4 uMatInvView;uniform mat4 uMatModel;uniform mat4 uMatVP;uniform lowp int uBillboardMode;uniform vec4 uColAlbedo;uniform vec2 uTexCoordOffset;uniform vec2 uTexCoordScale;out vec3 vPosition;out vec2 vTexCoord;out vec4 vColor;out mat3 vTBN;out vec4 vPosLightSpace[NUM_LIGHTS];void BillboardFront(inout mat4 i,inout mat3 j){float m=length(vec3(i[0]));float n=length(vec3(i[1]));float o=length(vec3(i[2]));i[0]=vec4(normalize(uMatInvView[0].xyz)*m,0.0);i[1]=vec4(normalize(uMatInvView[1].xyz)*n,0.0);i[2]=vec4(normalize(uMatInvView[2].xyz)*o,0.0);float c=1.0/m;float d=1.0/n;float e=1.0/o;j[0]=normalize(uMatInvView[0].xyz)*c;j[1]=normalize(uMatInvView[1].xyz)*d;j[2]=normalize(uMatInvView[2].xyz)*e;}void BillboardY(inout mat4 i,inout mat3 j){vec3 k=vec3(i[3]);float m=length(vec3(i[0]));float n=length(vec3(i[1]));float o=length(vec3(i[2]));vec3 p=normalize(vec3(i[1]));vec3 f=normalize(k-vec3(uMatInvView[3]));vec3 l=normalize(cross(p,f));vec3 a=normalize(cross(l,p));i[0]=vec4(l*m,0.0);i[1]=vec4(p*n,0.0);i[2]=vec4(a*o,0.0);float c=1.0/m;float d=1.0/n;float e=1.0/o;j[0]=l*c;j[1]=p*d;j[2]=a*e;}void main(){vTexCoord=uTexCoordOffset+aTexCoord*uTexCoordScale;vColor=aColor*iColor*uColAlbedo;mat4 g=uMatModel*transpose(iMatModel);mat3 h=mat3(0.0);if(uBillboardMode==BILLBOARD_FRONT)BillboardFront(g,h);else if(uBillboardMode==BILLBOARD_Y_AXIS)BillboardY(g,h);else h=transpose(inverse(mat3(g)));vPosition=vec3(g*vec4(aPosition,1.0));vec3 T=normalize(vec3(g*vec4(aTangent.xyz,0.0)));vec3 N=normalize(h*aNormal);vec3 B=normalize(cross(N,T))*aTangent.w;vTBN=mat3(T,B,N);for(int b=0;b < NUM_LIGHTS;b++){vPosLightSpace[b]=uMatLightVP[b]*vec4(vPosition,1.0);}gl_Position=uMatVP*(g*vec4(aPosition,1.0));}";
const char FS_RASTER_FORWARD[] = "#version 330 core\n#define PI 3.1415926535897932384626433832795028\n#define NUM_LIGHTS  8\n#define DIRLIGHT    0\n#define SPOTLIGHT   1\n#define OMNILIGHT   2\nstruct Light{sampler2D shadowMap;samplerCube shadowCubemap;vec3 color;vec3 position;vec3 direction;float specular;float energy;float range;float size;float near;float far;float attenuation;float innerCutOff;float outerCutOff;float shadowMapTxlSz;float shadowBias;lowp int type;bool enabled;bool shadow;};in vec3 vPosition;in vec2 vTexCoord;in vec4 vColor;in mat3 vTBN;in vec4 vPosLightSpace[NUM_LIGHTS];uniform sampler2D uTexAlbedo;uniform sampler2D uTexEmission;uniform sampler2D uTexNormal;uniform sampler2D uTexOcclusion;uniform sampler2D uTexRoughness;uniform sampler2D uTexMetalness;uniform sampler2D uTexNoise;uniform float uValEmission;uniform float uValOcclusion;uniform float uValRoughness;uniform float uValMetalness;uniform vec3 uColAmbient;uniform vec3 uColEmission;uniform samplerCube uCubeIrradiance;uniform samplerCube uCubePrefilter;uniform sampler2D uTexBrdfLut;uniform vec4 uQuatSkybox;uniform bool uHasSkybox;uniform Light uLights[NUM_LIGHTS];uniform float uAlphaScissorThreshold;uniform float uBloomHdrThreshold;uniform vec3 uViewPosition;uniform float uFar;layout(location=0)out vec4 e;layout(location=1)out vec3 d;const vec2 POISSON_DISK[16]=vec2[](vec2(-0.94201624,-0.39906216),vec2(0.94558609,-0.76890725),vec2(-0.094184101,-0.92938870),vec2(0.34495938,0.29387760),vec2(-0.91588581,0.45771432),vec2(-0.81544232,-0.87912464),vec2(-0.38277543,0.27676845),vec2(0.97484398,0.75648379),vec2(0.44323325,-0.97511554),vec2(0.53742981,-0.47373420),vec2(-0.26496911,-0.41893023),vec2(0.79197514,0.19090188),vec2(-0.24188840,0.99706507),vec2(-0.81409955,0.91437590),vec2(0.19984126,0.78641367),vec2(0.14383161,-0.14100790));float DistributionGGX(float z,float m){float k=z*m;float am=m/(1.0-z*z+k*k);return am*am*(1.0/PI);}float GeometryGGX(float h,float i,float bi){return 0.5/mix(2.0*h*i,h+i,bi);}float SchlickFresnel(float bu){float ap=1.0-bu;float aq=ap*ap;return aq*aq*ap;}vec3 ComputeF0(float ar,float specular,vec3 l){float ab=0.16*specular*specular;return mix(vec3(ab),l,vec3(ar));}float ShadowOmni(int ak,float cNdotL){vec3 ao=vPosition-uLights[ak].position;float aa=length(ao);vec3 direction=normalize(ao);float r=max(uLights[ak].shadowBias*(1.0-cNdotL),0.05);aa=aa-r;const int BLOCKER_SEARCH_NUM_SAMPLES=16;const int PCF_NUM_SAMPLES=16;const float MIN_PENUMBRA_SIZE=0.002;const float MAX_PENUMBRA_SIZE=0.02;vec4 at=texture(uTexNoise,fract(gl_FragCoord.xy/vec2(16.0)));float bg=at.r*2.0*PI;float bh=at.g*2.0*PI;vec3 bs,s;if(abs(direction.y)< 0.99)bs=normalize(cross(vec3(0.0,1.0,0.0),direction));else bs=normalize(cross(vec3(1.0,0.0,0.0),direction));s=normalize(cross(direction,bs));mat2 bd=mat2(cos(bg),-sin(bg),sin(bg),cos(bg));float t=0.0;float au=0.0;float bk=uLights[ak].size/aa;for(int al=0;al < BLOCKER_SEARCH_NUM_SAMPLES;al++){vec2 bf=bd*POISSON_DISK[al]*bk;vec3 bj=direction+(bs*bf.x+s*bf.y);bj=normalize(bj);float bl=texture(uLights[ak].shadowCubemap,bj).r*uLights[ak].far;if(bl < aa){t+=bl;au++;}}if(au < 1.0){return 1.0;}float q=t/au;float ay=(aa-q)/q;float ai=ay*uLights[ak].size*uLights[ak].near/aa;ai=clamp(ai,MIN_PENUMBRA_SIZE,MAX_PENUMBRA_SIZE);mat2 be=mat2(cos(bh),-sin(bh),sin(bh),cos(bh));float shadow=0.0;for(int am=0;am < PCF_NUM_SAMPLES;am++){vec2 bf=be*POISSON_DISK[am]*ai;vec3 bj=direction+(bs*bf.x+s*bf.y);bj=normalize(bj);float w=texture(uLights[ak].shadowCubemap,bj).r*uLights[ak].far;shadow+=step(aa,w);}return shadow/float(PCF_NUM_SAMPLES);}float Shadow(int ak,float cNdotL){vec4 ax=vPosLightSpace[ak];vec3 bb=ax.xyz/ax.w;bb=bb*0.5+0.5;if(bb.x < 0.0 || bb.x > 1.0 || bb.y < 0.0 || bb.y > 1.0 || bb.z < 0.0 || bb.z > 1.0)return 1.0;float r=max(uLights[ak].shadowBias*(1.0-cNdotL),0.00002);float aa=bb.z-r;const int BLOCKER_SEARCH_NUM_SAMPLES=16;const int PCF_NUM_SAMPLES=16;const float MIN_PENUMBRA_SIZE=0.001;const float MAX_PENUMBRA_SIZE=0.01;vec4 at=texture(uTexNoise,fract(gl_FragCoord.xy/vec2(16.0)));float bg=at.r*2.0*PI;float bh=at.g*2.0*PI;float x=cos(bg);float bm=sin(bg);float t=0.0;float au=0.0;float bk=uLights[ak].size/bb.z;for(int al=0;al < BLOCKER_SEARCH_NUM_SAMPLES;al++){vec2 az=vec2(POISSON_DISK[al].x*x-POISSON_DISK[al].y*bm,POISSON_DISK[al].x*bm+POISSON_DISK[al].y*x);vec2 aw=az*bk;float bl=texture(uLights[ak].shadowMap,bb.xy+aw).r;if(bl < aa){t+=bl;au++;}}if(au < 1.0){return 1.0;}float q=t/au;float ay=(aa-q)/q;float ai=ay*uLights[ak].size*uLights[ak].near/aa;ai=clamp(ai,MIN_PENUMBRA_SIZE,MAX_PENUMBRA_SIZE);float shadow=0.0;float y=cos(bh);float bn=sin(bh);for(int am=0;am < PCF_NUM_SAMPLES;am++){vec2 az=vec2(POISSON_DISK[am].x*y-POISSON_DISK[am].y*bn,POISSON_DISK[am].x*bn+POISSON_DISK[am].y*y);vec2 aw=az*ai;float w=texture(uLights[ak].shadowMap,bb.xy+aw).r;shadow+=step(aa,w);}return shadow/float(PCF_NUM_SAMPLES);}vec3 RotateWithQuat(vec3 bv,vec4 bc){vec3 br=2.0*cross(bc.xyz,bv);return bv+bc.w*br+cross(bc.xyz,br);}float GetBrightness(vec3 color){return length(color);}void main(){vec4 l=vColor*texture(uTexAlbedo,vTexCoord);if(l.a < uAlphaScissorThreshold)discard;vec3 ag=uValEmission*(uColEmission*texture(uTexEmission,vTexCoord).rgb);float av=uValOcclusion*texture(uTexOcclusion,vTexCoord).r;float bi=uValRoughness*texture(uTexRoughness,vTexCoord).g;float as=uValMetalness*texture(uTexMetalness,vTexCoord).b;vec3 F0=ComputeF0(as,0.5,l.rgb);vec3 N=normalize(vTBN*(texture(uTexNormal,vTexCoord).rgb*2.0-1.0));vec3 V=normalize(uViewPosition-vPosition);float i=dot(N,V);float cNdotV=max(i,1e-4);vec3 ae=vec3(0.0);vec3 specular=vec3(0.0);for(int ak=0;ak < NUM_LIGHTS;ak++){if(uLights[ak].enabled){vec3 L=vec3(0.0);if(uLights[ak].type==DIRLIGHT)L=-uLights[ak].direction;else L=normalize(uLights[ak].position-vPosition);float h=max(dot(N,L),0.0);float cNdotL=min(h,1.0);vec3 H=normalize(V+L);float f=max(dot(L,H),0.0);float cLdotH=min(dot(L,H),1.0);float g=max(dot(N,H),0.0);float cNdotH=min(g,1.0);vec3 an=uLights[ak].color*uLights[ak].energy;vec3 ad=vec3(0.0);if(as < 1.0){float a=2.0*cLdotH*cLdotH*bi-0.5;float c=1.0+a*SchlickFresnel(cNdotV);float b=1.0+a*SchlickFresnel(cNdotL);float ac=(1.0/PI)*(c*b*cNdotL);ad=ac*an;}vec3 bp=vec3(0.0);if(bi > 0.0){float n=bi*bi;float D=DistributionGGX(cNdotH,n);float G=GeometryGGX(cNdotL,cNdotV,n);float cLdotH5=SchlickFresnel(cLdotH);float F90=clamp(50.0*F0.g,0.0,1.0);vec3 F=F0+(F90-F0)*cLdotH5;vec3 bo=cNdotL*D*F*G;bp=bo*an*uLights[ak].specular;}float shadow=1.0;if(uLights[ak].shadow){if(uLights[ak].type !=OMNILIGHT)shadow=Shadow(ak,cNdotL);else shadow=ShadowOmni(ak,cNdotL);}if(uLights[ak].type !=DIRLIGHT){float af=length(uLights[ak].position-vPosition);float p=1.0-clamp(af/uLights[ak].range,0.0,1.0);shadow*=p*uLights[ak].attenuation;}if(uLights[ak].type==SPOTLIGHT){float bt=dot(L,-uLights[ak].direction);float ah=(uLights[ak].innerCutOff-uLights[ak].outerCutOff);shadow*=smoothstep(0.0,1.0,(bt-uLights[ak].outerCutOff)/ah);}ae+=ad*shadow;specular+=bp*shadow;}}vec3 o=uColAmbient;if(uHasSkybox){vec3 kS=F0+(1.0-F0)*SchlickFresnel(cNdotV);vec3 kD=(1.0-kS)*(1.0-as);vec3 j=RotateWithQuat(N,uQuatSkybox);o=kD*texture(uCubeIrradiance,j).rgb;}o*=av;if(uHasSkybox){vec3 R=RotateWithQuat(reflect(-V,N),uQuatSkybox);const float MAX_REFLECTION_LOD=7.0;vec3 ba=textureLod(uCubePrefilter,R,bi*MAX_REFLECTION_LOD).rgb;float aj=SchlickFresnel(cNdotV);vec3 F=F0+(max(vec3(1.0-bi),F0)-F0)*aj;vec2 u=texture(uTexBrdfLut,vec2(cNdotV,bi)).rg;vec3 bq=ba*(F*u.x+u.y);specular+=bq;}ae=l.rgb*(o+ae);e=vec4(ae+specular+ag,l.a);float v=GetBrightness(e.rgb);d=(v > uBloomHdrThreshold)? vec3(e.rgb): vec3(0.0);}";
const char VS_RASTER_SKYBOX[] = "#version 330 core\nlayout(location=0)in vec3 aPosition;uniform mat4 uMatProj;uniform mat4 uMatView;uniform vec4 uRotation;out vec3 vPosition;vec3 RotateWithQuat(vec3 d,vec4 a){vec3 c=2.0*cross(a.xyz,d);return d+a.w*c+cross(a.xyz,c);}void main(){vPosition=RotateWithQuat(aPosition,uRotation);mat4 b=mat4(mat3(uMatView));gl_Position=uMatProj*b*vec4(aPosition,1.0);}";
const char FS_RASTER_SKYBOX[] = "#version 330 core\nin vec3 vPosition;uniform samplerCube uCubeSky;uniform float uBloomHdrThreshold;layout(location=0)out vec3 b;layout(location=1)out vec3 a;float GetBrightness(vec3 d){return length(d);}void main(){b=texture(uCubeSky,vPosition).rgb;float c=GetBrightness(b.rgb);a=(c > uBloomHdrThreshold)? vec3(b.rgb): vec3(0.0);}";
const char VS_RASTER_DEPTH[] = "#version 330 core\nlayout(location=0)in vec3 aPosition;uniform mat4 uMatMVP;void main(){gl_Position=uMatMVP*vec4(aPosition,1.0);}";
const char VS_RASTER_DEPTH_INST[] = "#version 330 core\n#define BILLBOARD_FRONT 1\n#define BILLBOARD_Y_AXIS 2\nlayout(location=0)in vec3 aPosition;layout(location=10)in mat4 aInstanceModel;uniform mat4 uMatInvView;uniform mat4 uMatModel;uniform mat4 uMatVP;uniform lowp int uBillboardMode;void BillboardFront(inout mat4 d){float g=length(vec3(d[0]));float h=length(vec3(d[1]));float i=length(vec3(d[2]));d[0]=vec4(normalize(uMatInvView[0].xyz)*g,0.0);d[1]=vec4(normalize(uMatInvView[1].xyz)*h,0.0);d[2]=vec4(normalize(uMatInvView[2].xyz)*i,0.0);}void BillboardY(inout mat4 d){vec3 e=vec3(d[3]);float g=length(vec3(d[0]));float h=length(vec3(d[1]));float i=length(vec3(d[2]));vec3 j=normalize(vec3(d[1]));vec3 b=normalize(e-vec3(uMatInvView[3]));vec3 f=normalize(cross(j,b));vec3 a=normalize(cross(f,j));d[0]=vec4(f*g,0.0);d[1]=vec4(j*h,0.0);d[2]=vec4(a*i,0.0);}void main(){mat4 c=uMatModel*transpose(aInstanceModel);if(uBillboardMode==BILLBOARD_FRONT)BillboardFront(c);else if(uBillboardMode==BILLBOARD_Y_AXIS)BillboardY(c);gl_Position=uMatVP*(c*vec4(aPosition,1.0));}";
const char FS_RASTER_DEPTH[] = "#version 330 core\nvoid main(){}";
const char VS_RASTER_DEPTH_CUBE[] = "#version 330 core\nlayout(location=0)in vec3 aPosition;uniform mat4 uMatModel;uniform mat4 uMatMVP;out vec3 vPosition;void main(){vPosition=vec3(uMatModel*vec4(aPosition,1.0));gl_Position=uMatMVP*vec4(aPosition,1.0);}";
const char VS_RASTER_DEPTH_CUBE_INST[] = "#version 330 core\n#define BILLBOARD_FRONT 1\n#define BILLBOARD_Y_AXIS 2\nlayout(location=0)in vec3 aPosition;layout(location=10)in mat4 aInstanceModel;uniform mat4 uMatInvView;uniform mat4 uMatModel;uniform mat4 uMatVP;uniform lowp int uBillboardMode;out vec3 vPosition;void BillboardFront(inout mat4 d){float g=length(vec3(d[0]));float h=length(vec3(d[1]));float i=length(vec3(d[2]));d[0]=vec4(normalize(uMatInvView[0].xyz)*g,0.0);d[1]=vec4(normalize(uMatInvView[1].xyz)*h,0.0);d[2]=vec4(normalize(uMatInvView[2].xyz)*i,0.0);}void BillboardY(inout mat4 d){vec3 e=vec3(d[3]);float g=length(vec3(d[0]));float h=length(vec3(d[1]));float i=length(vec3(d[2]));vec3 j=normalize(vec3(d[1]));vec3 b=normalize(e-vec3(uMatInvView[3]));vec3 f=normalize(cross(j,b));vec3 a=normalize(cross(f,j));d[0]=vec4(f*g,0.0);d[1]=vec4(j*h,0.0);d[2]=vec4(a*i,0.0);}void main(){mat4 c=uMatModel*transpose(aInstanceModel);if(uBillboardMode==BILLBOARD_FRONT)BillboardFront(c);else if(uBillboardMode==BILLBOARD_Y_AXIS)BillboardY(c);vPosition=vec3(c*vec4(aPosition,1.0));gl_Position=uMatVP*(c*vec4(aPosition,1.0));}";
const char FS_RASTER_DEPTH_CUBE[] = "#version 330 core\nin vec3 vPosition;uniform vec3 uViewPosition;uniform float uFar;void main(){gl_FragDepth=length(vPosition-uViewPosition)/uFar;}";

const char FS_SCREEN_SSAO[] = "#version 330 core\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexDepth;uniform sampler2D uTexNormal;uniform sampler1D uTexKernel;uniform sampler2D uTexNoise;uniform mat4 uMatInvProj;uniform mat4 uMatInvView;uniform mat4 uMatProj;uniform mat4 uMatView;uniform vec2 uResolution;uniform float uNear;uniform float uFar;uniform float uRadius;uniform float uBias;out float a;vec3 GetPositionFromDepth(float c){vec4 i=vec4(vTexCoord*2.0-1.0,c*2.0-1.0,1.0);vec4 x=uMatInvProj*i;x/=x.w;return x.xyz;}vec3 DecodeOctahedral(vec2 d){vec2 e=d*2.0-1.0;vec3 k=vec3(e.xy,1.0-abs(e.x)-abs(e.y));if(k.z < 0.0){vec2 u=vec2(k.x >=0.0 ? 1.0 :-1.0,k.y >=0.0 ? 1.0 :-1.0);k.xy=(1.0-abs(k.yx))*u;}return normalize(mat3(uMatView)*k);}float LinearizeDepth(float c){float y=c*2.0-1.0;return(2.0*uNear*uFar)/(uFar+uNear-y*(uFar-uNear));}vec3 SampleKernel(int g,int h){float w=(float(g)+0.5)/float(h);return texture(uTexKernel,w).rgb;}void main(){float c=texture(uTexDepth,vTexCoord).r;vec3 n=GetPositionFromDepth(c);vec3 k=DecodeOctahedral(texture(uTexNormal,vTexCoord).rg);vec2 j=uResolution/16.0;vec3 o=normalize(texture(uTexNoise,vTexCoord*j).xyz*2.0-1.0);vec3 v=normalize(o-k*dot(o,k));vec3 b=cross(k,v);mat3 TBN=mat3(v,b,k);const int KERNEL_SIZE=32;float l=0.0;for(int f=0;f < KERNEL_SIZE;f++){vec3 r=TBN*SampleKernel(f,KERNEL_SIZE);float t=float(f)/float(KERNEL_SIZE);t=mix(0.1,1.0,t*t);r=n+r*uRadius*t;vec4 m=uMatProj*vec4(r,1.0);m.xyz/=m.w;m.xyz=m.xyz*0.5+0.5;if(m.x >=0.0 && m.x <=1.0 && m.y >=0.0 && m.y <=1.0){float q=texture(uTexDepth,m.xy).r;vec3 s=GetPositionFromDepth(q);float p=1.0-smoothstep(0.0,uRadius,abs(n.z-s.z));l+=(s.z >=r.z+uBias)? p : 0.0;}}a=1.0-(l/float(KERNEL_SIZE));}";
const char FS_SCREEN_AMBIENT[] = "#version 330 core\n#ifdef IBL\n#define PI 3.1415926535897932384626433832795028\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexAlbedo;uniform sampler2D uTexNormal;uniform sampler2D uTexDepth;uniform sampler2D uTexSSAO;uniform sampler2D uTexORM;uniform samplerCube uCubeIrradiance;uniform samplerCube uCubePrefilter;uniform sampler2D uTexBrdfLut;uniform vec4 uQuatSkybox;uniform vec3 uViewPosition;uniform mat4 uMatInvProj;uniform mat4 uMatInvView;layout(location=0)out vec3 a;layout(location=1)out vec3 b;float SchlickFresnel(float ab){float l=1.0-ab;float m=l*l;return m*m*l;}vec3 ComputeF0(float n,float y,vec3 e){float h=0.16*y*y;return mix(vec3(h),e,vec3(n));}vec3 GetPositionFromDepth(float g){vec4 p=vec4(vTexCoord*2.0-1.0,g*2.0-1.0,1.0);vec4 ad=uMatInvProj*p;ad/=ad.w;return(uMatInvView*ad).xyz;}vec3 DecodeOctahedral(vec2 i){vec2 j=i*2.0-1.0;vec3 q=vec3(j.xy,1.0-abs(j.x)-abs(j.y));if(q.z < 0.0){vec2 x=vec2(q.x >=0.0 ? 1.0 :-1.0,q.y >=0.0 ? 1.0 :-1.0);q.xy=(1.0-abs(q.yx))*x;}return normalize(q);}vec3 RotateWithQuat(vec3 ac,vec4 v){vec3 aa=2.0*cross(v.xyz,ac);return ac+v.w*aa+cross(v.xyz,aa);}void main(){vec3 e=texture(uTexAlbedo,vTexCoord).rgb;vec3 s=texture(uTexORM,vTexCoord).rgb;float r=s.r;float w=s.g;float o=s.b;r*=texture(uTexSSAO,vTexCoord).r;vec3 F0=ComputeF0(o,0.5,e);float g=texture(uTexDepth,vTexCoord).r;vec3 t=GetPositionFromDepth(g);vec3 N=DecodeOctahedral(texture(uTexNormal,vTexCoord).rg);vec3 V=normalize(uViewPosition-t);float c=dot(N,V);float cNdotV=max(c,1e-4);vec3 kS=F0+(1.0-F0)*SchlickFresnel(cNdotV);vec3 kD=(1.0-kS)*(1.0-o);vec3 d=RotateWithQuat(N,uQuatSkybox);a=kD*texture(uCubeIrradiance,d).rgb;a*=r;vec3 R=RotateWithQuat(reflect(-V,N),uQuatSkybox);const float MAX_REFLECTION_LOD=7.0;vec3 u=textureLod(uCubePrefilter,R,w*MAX_REFLECTION_LOD).rgb;float k=SchlickFresnel(cNdotV);vec3 F=F0+(max(vec3(1.0-w),F0)-F0)*k;vec2 f=texture(uTexBrdfLut,vec2(cNdotV,w)).rg;vec3 z=u*(F*f.x+f.y);b=z;}\n#else\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexSSAO;uniform sampler2D uTexORM;uniform vec4 uColor;layout(location=0)out vec4 a;void main(){float r=texture(uTexORM,vTexCoord).r;r*=texture(uTexSSAO,vTexCoord).r;a=uColor*r;}\n#endif";
const char FS_SCREEN_LIGHTING[] = "#version 330 core\n#define PI 3.1415926535897932384626433832795028\n#define DIRLIGHT    0\n#define SPOTLIGHT   1\n#define OMNILIGHT   2\nstruct Light{mat4 matVP;sampler2D shadowMap;samplerCube shadowCubemap;vec3 color;vec3 position;vec3 direction;float specular;float energy;float range;float size;float near;float far;float attenuation;float innerCutOff;float outerCutOff;float shadowMapTxlSz;float shadowBias;lowp int type;bool shadow;};noperspective in vec2 vTexCoord;uniform sampler2D uTexAlbedo;uniform sampler2D uTexNormal;uniform sampler2D uTexDepth;uniform sampler2D uTexORM;uniform sampler2D uTexNoise;uniform Light uLight;uniform vec3 uViewPosition;uniform mat4 uMatInvProj;uniform mat4 uMatInvView;layout(location=0)out vec4 d;layout(location=1)out vec4 e;const vec2 POISSON_DISK[16]=vec2[](vec2(-0.94201624,-0.39906216),vec2(0.94558609,-0.76890725),vec2(-0.094184101,-0.92938870),vec2(0.34495938,0.29387760),vec2(-0.91588581,0.45771432),vec2(-0.81544232,-0.87912464),vec2(-0.38277543,0.27676845),vec2(0.97484398,0.75648379),vec2(0.44323325,-0.97511554),vec2(0.53742981,-0.47373420),vec2(-0.26496911,-0.41893023),vec2(0.79197514,0.19090188),vec2(-0.24188840,0.99706507),vec2(-0.81409955,0.91437590),vec2(0.19984126,0.78641367),vec2(0.14383161,-0.14100790));float DistributionGGX(float v,float l){float j=v*l;float ah=l/(1.0-v*v+j*j);return ah*ah*(1.0/PI);}float GeometryGGX(float h,float i,float be){return 0.5/mix(2.0*h*i,h+i,be);}float SchlickFresnel(float bp){float ak=1.0-bp;float al=ak*ak;return al*al*ak;}vec3 ComputeF0(float am,float specular,vec3 k){float y=0.16*specular*specular;return mix(vec3(y),k,vec3(am));}float ShadowOmni(vec3 position,float cNdotL){vec3 aj=position-uLight.position;float w=length(aj);vec3 direction=normalize(aj);float p=max(uLight.shadowBias*(1.0-cNdotL),0.05);w=w-p;const int BLOCKER_SEARCH_NUM_SAMPLES=16;const int PCF_NUM_SAMPLES=16;const float MIN_PENUMBRA_SIZE=0.002;const float MAX_PENUMBRA_SIZE=0.02;vec4 ap=texture(uTexNoise,fract(gl_FragCoord.xy/vec2(16.0)));float bc=ap.r*2.0*PI;float bd=ap.g*2.0*PI;vec3 bn,q;if(abs(direction.y)< 0.99)bn=normalize(cross(vec3(0.0,1.0,0.0),direction));else bn=normalize(cross(vec3(1.0,0.0,0.0),direction));q=normalize(cross(direction,bn));mat2 az=mat2(cos(bc),-sin(bc),sin(bc),cos(bc));float r=0.0;float ar=0.0;float bg=uLight.size/w;for(int ag=0;ag < BLOCKER_SEARCH_NUM_SAMPLES;ag++){vec2 bb=az*POISSON_DISK[ag]*bg;vec3 bf=direction+(bn*bb.x+q*bb.y);bf=normalize(bf);float bh=texture(uLight.shadowCubemap,bf).r*uLight.far;if(bh < w){r+=bh;ar++;}}if(ar < 1.0){return 1.0;}float o=r/ar;float av=(w-o)/o;float af=av*uLight.size*uLight.near/w;af=clamp(af,MIN_PENUMBRA_SIZE,MAX_PENUMBRA_SIZE);mat2 ba=mat2(cos(bd),-sin(bd),sin(bd),cos(bd));float shadow=0.0;for(int ah=0;ah < PCF_NUM_SAMPLES;ah++){vec2 bb=ba*POISSON_DISK[ah]*af;vec3 bf=direction+(bn*bb.x+q*bb.y);bf=normalize(bf);float s=texture(uLight.shadowCubemap,bf).r*uLight.far;shadow+=step(w,s);}return shadow/float(PCF_NUM_SAMPLES);}float Shadow(vec3 position,float cNdotL){vec4 au=uLight.matVP*vec4(position,1.0);vec3 ax=au.xyz/au.w;ax=ax*0.5+0.5;if(ax.x < 0.0 || ax.x > 1.0 || ax.y < 0.0 || ax.y > 1.0 || ax.z < 0.0 || ax.z > 1.0)return 1.0;float p=max(uLight.shadowBias*(1.0-cNdotL),0.00002);float w=ax.z-p;const int BLOCKER_SEARCH_NUM_SAMPLES=16;const int PCF_NUM_SAMPLES=16;const float MIN_PENUMBRA_SIZE=0.001;const float MAX_PENUMBRA_SIZE=0.01;vec4 ap=texture(uTexNoise,fract(gl_FragCoord.xy/vec2(16.0)));float bc=ap.r*2.0*PI;float bd=ap.g*2.0*PI;float t=cos(bc);float bj=sin(bc);float r=0.0;float ar=0.0;float bg=uLight.size/ax.z;for(int ag=0;ag < BLOCKER_SEARCH_NUM_SAMPLES;ag++){vec2 aw=vec2(POISSON_DISK[ag].x*t-POISSON_DISK[ag].y*bj,POISSON_DISK[ag].x*bj+POISSON_DISK[ag].y*t);vec2 as=aw*bg;float bh=texture(uLight.shadowMap,ax.xy+as).r;if(bh < w){r+=bh;ar++;}}if(ar < 1.0){return 1.0;}float o=r/ar;float av=(w-o)/o;float af=av*uLight.size*uLight.near/w;af=clamp(af,MIN_PENUMBRA_SIZE,MAX_PENUMBRA_SIZE);float shadow=0.0;float u=cos(bd);float bk=sin(bd);for(int ah=0;ah < PCF_NUM_SAMPLES;ah++){vec2 aw=vec2(POISSON_DISK[ah].x*u-POISSON_DISK[ah].y*bk,POISSON_DISK[ah].x*bk+POISSON_DISK[ah].y*u);vec2 as=aw*af;float s=texture(uLight.shadowMap,ax.xy+as).r;shadow+=step(w,s);}return shadow/float(PCF_NUM_SAMPLES);}vec3 GetPositionFromDepth(float x){vec4 ao=vec4(vTexCoord*2.0-1.0,x*2.0-1.0,1.0);vec4 br=uMatInvProj*ao;br/=br.w;return(uMatInvView*br).xyz;}vec3 DecodeOctahedral(vec2 ac){vec2 ae=ac*2.0-1.0;vec3 aq=vec3(ae.xy,1.0-abs(ae.x)-abs(ae.y));if(aq.z < 0.0){vec2 bi=vec2(aq.x >=0.0 ? 1.0 :-1.0,aq.y >=0.0 ? 1.0 :-1.0);aq.xy=(1.0-abs(aq.yx))*bi;}return normalize(aq);}vec3 RotateWithQuat(vec3 bq,vec4 ay){vec3 bm=2.0*cross(ay.xyz,bq);return bq+ay.w*bm+cross(ay.xyz,bm);}void main(){vec3 k=texture(uTexAlbedo,vTexCoord).rgb;vec3 at=texture(uTexORM,vTexCoord).rgb;float be=at.g;float an=at.b;vec3 F0=ComputeF0(an,0.5,k);float x=texture(uTexDepth,vTexCoord).r;vec3 position=GetPositionFromDepth(x);vec3 N=DecodeOctahedral(texture(uTexNormal,vTexCoord).rg);vec3 V=normalize(uViewPosition-position);float i=dot(N,V);float cNdotV=max(i,1e-4);vec3 L=(uLight.type==DIRLIGHT)?-uLight.direction : normalize(uLight.position-position);float h=max(dot(N,L),0.0);float cNdotL=min(h,1.0);vec3 H=normalize(V+L);float f=max(dot(L,H),0.0);float cLdotH=min(dot(L,H),1.0);float g=max(dot(N,H),0.0);float cNdotH=min(g,1.0);vec3 ai=uLight.color*uLight.energy;vec3 aa=vec3(0.0);if(an < 1.0){float a=2.0*cLdotH*cLdotH*be-0.5;float c=1.0+a*SchlickFresnel(cNdotV);float b=1.0+a*SchlickFresnel(cNdotL);float z=(1.0/PI)*(c*b*cNdotL);aa=z*ai;}vec3 specular=vec3(0.0);if(be > 0.0){float m=be*be;float D=DistributionGGX(cNdotH,m);float G=GeometryGGX(cNdotL,cNdotV,m);float cLdotH5=SchlickFresnel(cLdotH);float F90=clamp(50.0*F0.g,0.0,1.0);vec3 F=F0+(F90-F0)*cLdotH5;vec3 bl=cNdotL*D*F*G;specular=bl*ai*uLight.specular;}float shadow=1.0;if(uLight.shadow){if(uLight.type !=OMNILIGHT)shadow=Shadow(position,cNdotL);else shadow=ShadowOmni(position,cNdotL);}if(uLight.type !=DIRLIGHT){float ab=length(uLight.position-position);float n=1.0-clamp(ab/uLight.range,0.0,1.0);shadow*=n*uLight.attenuation;}if(uLight.type==SPOTLIGHT){float bo=dot(L,-uLight.direction);float ad=(uLight.innerCutOff-uLight.outerCutOff);shadow*=smoothstep(0.0,1.0,(bo-uLight.outerCutOff)/ad);}d=vec4(aa*shadow,1.0);e=vec4(specular*shadow,1.0);}";
const char FS_SCREEN_SCENE[] = "#version 330 core\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexAlbedo;uniform sampler2D uTexEmission;uniform sampler2D uTexDiffuse;uniform sampler2D uTexSpecular;uniform float uBloomHdrThreshold;layout(location=0)out vec3 b;layout(location=1)out vec3 a;float GetBrightness(vec3 e){return length(e);}void main(){vec3 c=texture(uTexAlbedo,vTexCoord).rgb;vec3 g=texture(uTexEmission,vTexCoord).rgb;vec3 f=texture(uTexDiffuse,vTexCoord).rgb;vec3 i=texture(uTexSpecular,vTexCoord).rgb;b=(c*f)+i+g;float d=GetBrightness(b);float h=step(uBloomHdrThreshold,d);a=b*h;}";
const char FS_SCREEN_BLOOM[] = "#version 330 core\n#define BLOOM_DISABLED 0\n#define BLOOM_ADDITIVE 1\n#define BLOOM_SOFT_LIGHT 2\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexColor;uniform sampler2D uTexBloomBlur;uniform lowp int uBloomMode;uniform float uBloomIntensity;out vec3 a;void main(){vec3 c=texture(uTexColor,vTexCoord).rgb;vec3 b=texture(uTexBloomBlur,vTexCoord).rgb;b*=uBloomIntensity;if(uBloomMode==BLOOM_SOFT_LIGHT){b=clamp(b.rgb,vec3(0.0),vec3(1.0));c=max((c+b)-(c*b),vec3(0.0));}else if(uBloomMode==BLOOM_ADDITIVE){c+=b;}a=vec3(c);}";
const char FS_SCREEN_FOG[] = "#version 330 core\n#define FOG_DISABLED 0\n#define FOG_LINEAR 1\n#define FOG_EXP2 2\n#define FOG_EXP 3\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexColor;uniform sampler2D uTexDepth;uniform float uNear;uniform float uFar;uniform lowp int uFogMode;uniform vec3 uFogColor;uniform float uFogStart;uniform float uFogEnd;uniform float uFogDensity;out vec4 a;float LinearizeDepth(float d,float j,float g){return(2.0*j*g)/(g+j-(2.0*d-1.0)*(g-j));;}float FogFactorLinear(float e,float l,float f){return 1.0-clamp((f-e)/(f-l),0.0,1.0);}float FogFactorExp2(float e,float c){const float LOG2=-1.442695;float b=c*e;return 1.0-clamp(exp2(b*b*LOG2),0.0,1.0);}float FogFactorExp(float e,float c){return 1.0-clamp(exp(-c*e),0.0,1.0);}float FogFactor(float e,int i,float c,float l,float f){if(i==FOG_LINEAR)return FogFactorLinear(e,l,f);if(i==FOG_EXP2)return FogFactorExp2(e,c);if(i==FOG_EXP)return FogFactorExp(e,c);return 1.0;}void main(){vec3 k=texture(uTexColor,vTexCoord).rgb;float d=texture(uTexDepth,vTexCoord).r;d=LinearizeDepth(d,uNear,uFar);float h=FogFactor(d,uFogMode,uFogDensity,uFogStart,uFogEnd);k=mix(k,uFogColor,h);a=vec4(k,1.0);}";
const char FS_SCREEN_TONEMAP[] = "#version 330 core\n#define TONEMAP_LINEAR 0\n#define TONEMAP_REINHARD 1\n#define TONEMAP_FILMIC 2\n#define TONEMAP_ACES 3\n#define TONEMAP_AGX 4\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexColor;uniform lowp int uTonemapMode;uniform float uTonemapExposure;uniform float uTonemapWhite;out vec4 a;vec3 TonemapReinhard(vec3 c,float pWhite){float l=pWhite*pWhite;vec3 m=l*c;return(m+c*c)/(m+l);}vec3 TonemapFilmic(vec3 c,float pWhite){const float e=2.0f;const float A=0.22f*e*e;const float B=0.30f*e;const float C=0.10f;const float D=0.20f;const float E=0.01f;const float F=0.30f;vec3 d=((c*(A*c+C*B)+D*E)/(c*(A*c+B)+D*F))-E/F;float pWhiteTonemapped=((pWhite*(A*pWhite+C*B)+D*E)/(pWhite*(A*pWhite+B)+D*F))-E/F;return d/pWhiteTonemapped;}vec3 TonemapACES(vec3 c,float pWhite){const float e=1.8f;const float A=0.0245786f;const float B=0.000090537f;const float C=0.983729f;const float D=0.432951f;const float E=0.238081f;const mat3 j=mat3(vec3(0.59719f*e,0.35458f*e,0.04823f*e),vec3(0.07600f*e,0.90834f*e,0.01566f*e),vec3(0.02840f*e,0.13383f*e,0.83777f*e));const mat3 h=mat3(vec3(1.60475f,-0.53108f,-0.07367f),vec3(-0.10208f,1.10813f,-0.00605f),vec3(-0.00327f,-0.07276f,1.07602f));c*=j;vec3 d=(c*(c+A)-B)/(c*(C*c+D)+E);d*=h;pWhite*=e;float pWhiteTonemapped=(pWhite*(pWhite+A)-B)/(pWhite*(C*pWhite+D)+E);return d/pWhiteTonemapped;}vec3 AgXContrastApprox(vec3 n){vec3 o=n*n;vec3 p=o*o;return 0.021*n+4.0111*o-25.682*o*n+70.359*p-74.778*p*n+27.069*p*o;}vec3 TonemapAgX(vec3 c){const mat3 k=mat3(0.54490813676363087053,0.14044005884001287035,0.088827411851915368603,0.37377945959812267119,0.75410959864013760045,0.17887712465043811023,0.081384976686407536266,0.10543358536857773485,0.73224999956948382528);const mat3 b=mat3(1.9645509602733325934,-0.29932243390911083839,-0.16436833806080403409,-0.85585845117807513559,1.3264510741502356555,-0.23822464068860595117,-0.10886710826831608324,-0.027084020983874825605,1.402665347143271889);const float g=-12.4739311883324;const float f=4.02606881166759;c=max(c,2e-10);c=k*c;c=clamp(log2(c),g,f);c=(c-g)/(f-g);c=AgXContrastApprox(c);c=pow(c,vec3(2.4));c=b*c;return c;}vec3 Tonemapping(vec3 c,float pWhite){if(uTonemapMode==TONEMAP_REINHARD)return TonemapReinhard(max(vec3(0.0f),c),pWhite);if(uTonemapMode==TONEMAP_FILMIC)return TonemapFilmic(max(vec3(0.0f),c),pWhite);if(uTonemapMode==TONEMAP_ACES)return TonemapACES(max(vec3(0.0f),c),pWhite);if(uTonemapMode==TONEMAP_AGX)return TonemapAgX(c);return c;}void main(){vec3 i=texture(uTexColor,vTexCoord).rgb;i*=uTonemapExposure;i=Tonemapping(i,uTonemapWhite);a=vec4(i,1.0);}";
const char FS_SCREEN_ADJUSTMENT[] = "#version 330 core\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexColor;uniform float uBrightness;uniform float uContrast;uniform float uSaturation;out vec4 a;vec3 LinearToSRGB(vec3 b){return max(vec3(1.055)*pow(b,vec3(0.416666667))-vec3(0.055),vec3(0.0));}void main(){vec3 c=texture(uTexColor,vTexCoord).rgb;c=mix(vec3(0.0),c,uBrightness);c=mix(vec3(0.5),c,uContrast);c=mix(vec3(dot(vec3(1.0),c)*0.33333),c,uSaturation);c=LinearToSRGB(c);a=vec4(c,1.0);}";
const char FS_SCREEN_FXAA[] = "#version 330 core\nnoperspective in vec2 vTexCoord;uniform sampler2D uTexture;uniform vec2 uTexelSize;out vec4 a;\n#define FXAA_PRESET 5\n#if(FXAA_PRESET==3)\n#define FXAA_EDGE_THRESHOLD (1.0/8.0)\n#define FXAA_EDGE_THRESHOLD_MIN (1.0/16.0)\n#define FXAA_SEARCH_STEPS        16\n#define FXAA_SEARCH_THRESHOLD (1.0/4.0)\n#define FXAA_SUBPIX_CAP (3.0/4.0)\n#define FXAA_SUBPIX_TRIM (1.0/4.0)\n#endif\n#if(FXAA_PRESET==4)\n#define FXAA_EDGE_THRESHOLD (1.0/8.0)\n#define FXAA_EDGE_THRESHOLD_MIN (1.0/24.0)\n#define FXAA_SEARCH_STEPS        24\n#define FXAA_SEARCH_THRESHOLD (1.0/4.0)\n#define FXAA_SUBPIX_CAP (3.0/4.0)\n#define FXAA_SUBPIX_TRIM (1.0/4.0)\n#endif\n#if(FXAA_PRESET==5)\n#define FXAA_EDGE_THRESHOLD (1.0/8.0)\n#define FXAA_EDGE_THRESHOLD_MIN (1.0/24.0)\n#define FXAA_SEARCH_STEPS        32\n#define FXAA_SEARCH_THRESHOLD (1.0/4.0)\n#define FXAA_SUBPIX_CAP (3.0/4.0)\n#define FXAA_SUBPIX_TRIM (1.0/4.0)\n#endif\n#define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0-FXAA_SUBPIX_TRIM))\nfloat FxaaLuma(vec3 an){return an.y*(0.587/0.299)+an.x;}vec3 FxaaLerp3(vec3 b,vec3 d,float c){return(vec3(-c)*d)+((b*vec3(c))+d);}vec4 FxaaTexOff(sampler2D bb,vec2 af,ivec2 ad,vec2 am){float bc=af.x+float(ad.x)*am.x;float bd=af.y+float(ad.y)*am.y;return texture(bb,vec2(bc,bd));}void main(){vec2 af=vTexCoord;vec3 as=FxaaTexOff(uTexture,af.xy,ivec2(0,-1),uTexelSize).xyz;vec3 ay=FxaaTexOff(uTexture,af.xy,ivec2(-1,0),uTexelSize).xyz;vec3 ar=FxaaTexOff(uTexture,af.xy,ivec2(0,0),uTexelSize).xyz;vec3 ao=FxaaTexOff(uTexture,af.xy,ivec2(1,0),uTexelSize).xyz;vec3 av=FxaaTexOff(uTexture,af.xy,ivec2(0,1),uTexelSize).xyz;float w=FxaaLuma(as);float ac=FxaaLuma(ay);float v=FxaaLuma(ar);float r=FxaaLuma(ao);float z=FxaaLuma(av);float al=min(v,min(min(w,ac),min(z,r)));float ak=max(v,max(max(w,ac),max(z,r)));float ai=ak-al;if(ai < max(FXAA_EDGE_THRESHOLD_MIN,ak*FXAA_EDGE_THRESHOLD)){a=vec4(ar,1.0);return;}vec3 aq=as+ay+ar+ao+av;float u=(w+ac+r+z)*0.25;float aj=abs(u-v);float e=max(0.0,(aj/ai)-FXAA_SUBPIX_TRIM)*FXAA_SUBPIX_TRIM_SCALE;e=min(FXAA_SUBPIX_CAP,e);vec3 au=FxaaTexOff(uTexture,af.xy,ivec2(-1,-1),uTexelSize).xyz;vec3 at=FxaaTexOff(uTexture,af.xy,ivec2(1,-1),uTexelSize).xyz;vec3 ax=FxaaTexOff(uTexture,af.xy,ivec2(-1,1),uTexelSize).xyz;vec3 aw=FxaaTexOff(uTexture,af.xy,ivec2(1,1),uTexelSize).xyz;aq+=(au+at+ax+aw);aq*=vec3(1.0/9.0);float y=FxaaLuma(au);float x=FxaaLuma(at);float ab=FxaaLuma(ax);float aa=FxaaLuma(aw);float l=abs((0.25*y)+(-0.5*w)+(0.25*x))+abs((0.50*ac)+(-1.0*v)+(0.50*r))+abs((0.25*ab)+(-0.5*z)+(0.25*aa));float k=abs((0.25*y)+(-0.5*ac)+(0.25*ab))+abs((0.50*w)+(-1.0*v)+(0.50*z))+abs((0.25*x)+(-0.5*r)+(0.25*aa));bool o=k >=l;float q=o ?-uTexelSize.y :-uTexelSize.x;if(!o){w=ac;z=r;}float m=abs(w-v);float n=abs(z-v);w=(w+v)*0.5;z=(z+v)*0.5;if(m < n){w=z;w=z;m=n;q*=-1.0;}vec2 ag;ag.x=af.x+(o ? 0.0 : q*0.5);ag.y=af.y+(o ? q*0.5 : 0.0);m*=FXAA_SEARCH_THRESHOLD;vec2 ah=ag;vec2 ae=o ? vec2(uTexelSize.x,0.0): vec2(0.0,uTexelSize.y);float s=w;float t=w;bool g=false;bool h=false;ag+=ae*vec2(-1.0,-1.0);ah+=ae*vec2(1.0,1.0);for(int p=0;p < FXAA_SEARCH_STEPS;p++){if(!g){s=FxaaLuma(texture(uTexture,ag.xy).xyz);}if(!h){t=FxaaLuma(texture(uTexture,ah.xy).xyz);}g=g ||(abs(s-w)>=m);h=h ||(abs(t-w)>=m);if(g && h){break;}if(!g){ag-=ae;}if(!h){ah+=ae;}}float i=o ? af.x-ag.x : af.y-ag.y;float j=o ? ah.x-af.x : ah.y-af.y;bool f=i < j;s=f ? s : t;if(((v-w)< 0.0)==((s-w)< 0.0)){q=0.0;}float az=(j+i);i=f ? i : j;float ba=(0.5+(i*(-1.0/az)))*q;vec3 ap=texture(uTexture,vec2(af.x+(o ? 0.0 : ba),af.y+(o ? ba : 0.0))).xyz;a=vec4(FxaaLerp3(aq,ap,e),1.0);}";
